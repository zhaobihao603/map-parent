<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.imap.cloud.common.dao.map.BusRouteMapper">
  <resultMap id="BaseResultMap" type="com.imap.cloud.common.entity.map.BusRoute">
    <id column="id" jdbcType="CHAR" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="from_id" jdbcType="CHAR" property="fromId" />
    <result column="to_id" jdbcType="CHAR" property="toId" />
    <result column="xs" jdbcType="LONGVARCHAR" property="xs" />
    <result column="ys" jdbcType="LONGVARCHAR" property="ys" />
  </resultMap>
  <resultMap id="BaseResultMapWithNodes" type="com.imap.cloud.common.entity.map.BusRoute" extends="BaseResultMap">
  	<!-- 通过point的id去查询 -->
  	<association property="from"  column="from_id" select="getPoint">
  	</association>
  	<association property="to"  column="to_id" select="getPoint">
  	</association>
  </resultMap>
  <sql id="Base_Column_List">
    id, name, from_id, to_id, xs, ys
  </sql>
  <select id="getPoint" parameterType="java.lang.String" resultType="com.imap.cloud.common.entity.system.DictionaryItem">
  	select 
    n.id, n.code, n.parentid,n.shortvalue, n.value
    from common_datadir_item n 
    where n.id=#{id,jdbcType=CHAR}
  </select>
  <select id="getBusRoutes" resultMap="BaseResultMapWithNodes" parameterType="Map">
  	select 
  	<include refid="Base_Column_List"/>
  	from school_bus_route 
  	where 1=1 
  	<if test="id!=null and  id!=''">
  		and id=#{id,jdbcType=CHAR} 
  	</if>
  	<if test="name!=null and  name!=''">
  		and name like CONCAT('%',#{name,jdbcType=VARCHAR},'%' ) 
  	</if>
  	<if test="fromId!=null and  fromId!=''">
  		and from_id=#{fromId,jdbcType=CHAR} 
  	</if>
  	<if test="toId!=null and  toId!=''">
  		and to_id=#{toId,jdbcType=CHAR}
  	</if>
  </select>
  <insert id="insert" parameterType="com.imap.cloud.common.entity.map.BusRoute">
	<selectKey keyProperty="id" resultType="String" order="BEFORE">  
		select  replace(uuid(),'-','')   from dual  
	</selectKey>
	insert into school_bus_route(id,name,from_id,to_id,xs,ys)
	values(#{id,jdbcType=CHAR},#{name,jdbcType=VARCHAR},#{fromId,jdbcType=CHAR},
		#{toId,jdbcType=CHAR},#{xs,jdbcType=LONGVARCHAR},#{ys,jdbcType=LONGVARCHAR})
  </insert>
  <update id="update" parameterType="com.imap.cloud.common.entity.map.BusRoute">
	update school_bus_route 
	<set>
		<if test="name != null" >
			name=#{name,jdbcType=VARCHAR},
		</if>
		<if test="fromId != null" >
			from_id=#{fromId,jdbcType=CHAR},
		</if>
		<if test="toId != null" >
			to_id=#{toId,jdbcType=CHAR},
		</if>
		<if test="xs != null" >
			xs=#{xs,jdbcType=LONGVARCHAR},
		</if>
		<if test="ys != null" >
			ys=#{ys,jdbcType=LONGVARCHAR}
		</if>
	</set>
	where id=#{id,jdbcType=CHAR}
  </update>
  <delete id="delete" parameterType="java.lang.String">
		delete from school_bus_route where id=#{id,jdbcType=CHAR}
  </delete>	
</mapper>